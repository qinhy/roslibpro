<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.js"></script>
    <title>Test</title>
</head>

<body>    
    <script type="module">
        import {RosClientManager} from "./roslibpro/RosClientManager.js";

        const rosIP = '192.168.1.171:9090';
        const roslm = new RosClientManager();
        
        const test_srv = ()=>
        {
            const uuid = roslm.add_new_service(rosIP,'/rosapi/topics', 'rosapi/Topics');
            roslm.get(uuid).connectROS( {
                onError: (error) => { },
                onConnection: () => {
                    roslm.get(uuid).callService().then((result) => {
                        if (result) {
                            console.log(result);
                        }
                        }).catch((err) => {
                            console.log(err);
                        });
                },
                onClose: () => { }
            });
        }
        
        const test_reload = ()=>
        {
            const ss = roslm.dumps();
            console.log(roslm.dumps())
            roslm.clean();
            roslm.loads(ss);
            roslm.connect();
            
            roslm.srvs()[0].callService().then((result) => {
                    if (result) {
                        console.log(result);
                    }
                    }).catch((err) => {
                        console.log(err);
                    });
        }

        const test_sub = ()=>
        {            
            roslm.clean();
            const uuid = roslm.add_new_sub(rosIP, '/client_count', 'std_msgs/msg/Int32');
            const sub = roslm.get(uuid);
            sub.connectROS();
            sub.subscribe = (msg)=>{
                console.log(msg);
            }
        }

        test_srv();
        test_reload();
        test_sub();
    </script>
    <!-- <script type="module">
        import RosClientManager from './roslibpro/RosClientManager.js';
    </script> -->
</body>

</html>